---
title: マジカルバナナ
description: Japanese word association game where players take turns saying related words
author: トロストマシュー
language: ja
tags:
  - game
  - kid-friendly
initialWord: バナナ
starterWords:
  - 黄色
  - サル
  - 甘い
  - 南国
  - フルーツ
  - 皮
  - 長い
  - 朝ごはん
  - スムージー
  - 棒
---

<p id="start">
  マジカルバナナをプレイしましょう！始めます。
</p>

<var name="prevWord" type="string" value="{{initialWord}}">
<var name="currWord" type="string" value="{$ randElement(starterWords) $}">
<var name="wordsUsed" type="array<string>" value="{{prevWord}}, {{currWord}}" />

<loop>
  <p>{{prevWord}}と言ったら{{currWord}}</p>

  <input />

  <llm:parse
    key="response"
    promptWord="the word the player was given - ok if omitted"
    answerWord="the word the player answered">
    The user is playing Magical Banana. Their answer should be in the form Xと言ったらY or similar. Flexibly parse what they said:
    {{input}}
  </llm:parse>

  <if cond="wordsUsed.includes(response.answerWord)">
    <p>言葉を繰り返しました！</p>
    <jump to="lose" />
  </if>

  <llm:score
    key="score"
    relevance="how relevant the answer word is to the given word">
    Return a score indicating how related two words are.
    The given word was {{currWord}}. The answer word was {{response.answerWord}}.
    How related are the two words? Be a bit liberal in your interpretation.
    For example: Banana+yellow is 1.0. Banana+cat is 0.0. Banana+popsicle is 0.5. Car+engine is 1.0. Car+winter is 0.1.
  </llm:score>

  <if cond="score.relevance < 0.5">
    <p>無関係な言葉です!</p>
    <jump to="lose" />
  </if>

  <script>
    wsl.set("wordsUsed", [...wsl.get("wordsUsed"), response.answerWord])
  </script>

  <llm:text key="nextWord">
    We're playing Magical Banana! Your opponent's word was {{response.answerWord}}.
    What is a word related to that word?
    FORBIDDEN WORDS: {{wordsUsed}}
    Your word must be in Japanese.
    Return ONLY the word you choose for your response:
  </llm:text>

  <script>
    wsl.set("prevWord", response.answerWord)
    wsl.set("currWord", nextWord)
    wsl.set("wordsUsed", [...wsl.get("wordsUsed"), nextWord])
  </script>
</loop>

<div id="lose">
  <p>ゲームオーバー！</p>
  <jump to="replay">
</div>

<div id="replay">
  <p>もう一度プレイしますか？</p>
  <input key="playAgain" answer.type="boolean" answer.description="true if the user said 'yes', 'let's go', 'why not', 'はい', 'one more time' (etc)  or amything in the affirmative; false if not" />
  <if cond="playAgain.answer">
    <jump to="start" />
  </if>
  <jump to="exit" />
</div>

<div id="exit">
  <p>またね！</p>
  <exit />
</div>
