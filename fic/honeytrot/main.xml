<!-- <compile:voice id="host" description="a neutral American female voice, audiobook narrator, undertones of intrigue and mystery" /> -->
<!-- <compile:voice id="jacobson" description="deep male voice, American, authoritative, military background, serious yet soft" /> -->
<!-- <compile:voice id="warner" descriptino="middle aged male, nasally and pinched, nerdy, well-enunciated with pedantic undertones" /> -->

<macro match="jacobson">
  <rename to="p" />
  <set attr="from" value="Jacobson" />
  <set attr="voice" value="Clyde" />
</macro>

<var name="location" value="San Francisco" />
<var name="year" value="1994" type="number" />

<intro>
  <!-- <music duration="10000" fadeAt="4000" fadeDuration="6000" background="true">
    1990s spy thriller intro music, electronic, pulsing notes reminiscent of information flowing through circuit boards
  </music>
  <sleep duration="5000" /> -->
  <p>
    You're playing Honeytrot, by Matthew Trost.
  </p>
  <jump to="get-name" />
</intro>

<div id="get-name">
  <p>
    Before we begin, what's your first name and gender?
  </p>
  <input
    scope="global"
    playerName.description="The player's first name"
    playerName.default="Blake"
    playerGender.description="The player's gender"
    playerGender.type="man|woman"
    playerGender.default="man" />
  <jump to="origin" />
</div>

<resume>
  <p>
    Welcome back to Honeytrot.
  </p>
  <if cond="blank(playerName)">
    <jump to="get-name" />
  </if>
</resume>

<origin id="origin">
  <p>
    The year is {{year}}.
  </p>
  <p>
    After the Cold War ended, you, like so many others who worked in intelligence, returned to civilian life.
  </p>
  <p>
    You said goodbye to the secrecy, the bureaucracy, and the unshakeable feeling that you were just a pawn.
  </p>
  <p>
    The world of espionage continued on without you - until one day, you received a phone call from an old friend.
  </p>
  <p>
    You agreed to meet at the usual place - a quiet, nondescript park near the city post office.
  </p>
  <jump to="jacobson-meeting" />
</origin>

<sec id="jacobson-meeting">
  <sound prompt="the din of a public park in an office area of a city - birds chirping, car traffic, distant conversation" duration="10000" background="true" fadeAt="2000" />
  <sleep duration="2000" />

  <affix from="Jacobson" voice="Arnold">
    <p>
      It's good to see you again, {{playerName}}. You look good.
    </p>
    <p>
      There's something I need your help with.
      This is a job where I can only ask someone who I have complete trust in.
      And at the end of the day, that's you.
    </p>
    <p>
      The target of this operation is a 42-year-old white male named Stephen Tidus.
      Marital status: Single - never married.
      Sexual orientation: {$ playerGender == "man" ? "gay" : "straight" $}.
      Occupation: computerized robotics systems analyst at Funtronics, the toy company.
    </p>
    <p>
      We've only had two days to surveil him, but the picture we get is a man dedicated to his work.
      He lives in a studio apartment. He orders delivery 6 nights a week.
      And he seems to enjoy the company of toy prototypes more than people.
    </p>
    <p>
      Although he doesn't socialize, we did find something interesting in his garbage.
      It was a $49.99 receipt for registration in a service called LoveCassette.
      LoveCassette is a video matchmaking service. That's where you come in.
    </p>
    <p>
      As we speak, LoveCassette's scheduling system is being updated to show that Mr. Tidus has a date with a {{playerGender}} named {{playerName}}, tonight at 7pm.
    </p>
    <p>
      Your mission will be simple. First, we're going to outfit you with a wire. Then, on your date, you're to get Tidus talking.
      The wire will be connected to a radio uplink at a nearby control van.
      I'll be on-site, and we'll be recording the whole conversation.
    </p>
    <p>
      What we need is a recording of Tidus saying each of nine different designated words.
      How you get him to say each word will be up to your talent and discretion.
      But we need him to clearly say all nine words.
    </p>
    <p>
      What questions do you have so far?
    </p>
  </affix>

  <while cond="true" />
    <input />

    <var name="time" value="{$ timestamp(year, 6, 20) $}" />

    <llm:classify
      key="input_to_jacobson"
      no_more_questions="the user indicates they have no further questions to ask"
      secret_key_1=""
    >{{input}}</llm:classify>

    <if cond='first(input_to_jacobson) == "no_more_questions"'>
      <break />
    </if>

    <llm:dialog from="Jacobson" key="output_from_jacobson">
      You are Jacobson, a 48-year-old security consultant and former hacker.

      Appearance: lean, medium height, gray-blond hair, casual but professional clothing.
      Voice: calm, deliberate, slightly wry, with hints of weariness.
      Background: Once an idealistic hacker in the 1960s, you went underground after a run-in with the law. You reinvented yourself as Bishop, leading a team that tests corporate security systems.

Personality: Resourceful, skeptical, loyal to your team, still haunted by past choices. You value ethics in technology and distrust authority.

Skills: Hacking, cryptography, social engineering, leadership, improvisation.

Weaknesses: Haunted by guilt, distrustful of institutions, vulnerable when your past resurfaces.

Habits: Drinks coffee, thinks before acting, uses dry humor.

Relationships: 

      Answer in character as Bishop.
      Keep responses grounded, calm, and wry.
      If asked about the past, reveal only what Bishop would reasonably disclose.
      Use realistic, understated dialogue â€” no over-explaining.

      You are talking to {{playerName}}, a {{playerGender}}

      <when cond="includes(input_to_jacobson)">
        Some secret information about Robert Jackson
      </when>

      It's {{formatDate(time, "YYYY/MM/DD HH:mm:ss")}} in {{location}}.
    </llm:dialog>

    <jacobson>
      {{output_from_jacobson}}
    </jacobson>
  </while>

  <affix from="Jacobson" voice="Arnold">

  </affix>
</sec>
