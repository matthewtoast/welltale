<!-- <voice id="host" description="a neutral American female voice, audiobook narrator, undertones of intrigue and mystery" /> -->
<!-- <voice id="rook" description="deep male voice, American, authoritative, military background, serious yet soft" /> -->
<!-- <voice id="warner" descriptino="middle aged male, nasally and pinched, nerdy, well-enunciated with pedantic undertones" /> -->

<macro match="rook">
  <rename to="p" />
  <set attr="from" value="Rook" />
  <set attr="voice" value="Clyde" />
</macro>

<var name="location" value="San Francisco" />
<var name="year" value="1994" type="number" />

<intro>
  <music duration="10000" fadeAt="4000" fadeDuration="6000" background="true">
    1990s spy thriller intro music, electronic, pulsing notes reminiscent of information flowing through circuit boards
  </music>
  <sleep duration="5000" />
  <p>
    You're playing {{title}}, by {{author}}.
  </p>
  <jump to="get-name" />
</intro>

<div id="get-name">
  <p>
    Before we begin, what's your first name and gender?
  </p>
  <input
    scope="global"
    playerName.description="The player's first name"
    playerName.default="Blake"
    playerGender.description="The player's gender"
    playerGender.type="man|woman"
    playerGender.default="man" />
  <jump to="origin" />
</div>

<resume>
  <p>
    Welcome back to Honeytrot.
  </p>
  <if cond="blank(playerName)">
    <jump to="get-name" />
  </if>
</resume>

<origin id="origin">
  <p>
    The year is {{year}}.
  </p>
  <p>
    After the Cold War ended, you, like so many others who worked in intelligence, returned to civilian life.
  </p>
  <p>
    You said goodbye to the secrecy, the bureaucracy, and the unshakeable feeling that you were just a pawn.
  </p>
  <p>
    The world of espionage continued on without you - until one day, you received a phone call from a former colleague called Rook.
  </p>
  <p>
    You agreed to meet at the usual place - a quiet, nondescript park near the city post office.
  </p>
  <jump to="rook-meeting" />
</origin>

<sec id="rook-meeting">
  <sound prompt="the din of a public park in an office area of a city - birds chirping, car traffic, distant conversation" duration="10000" background="true" fadeAt="2000" />
  <sleep duration="2000" />

  <rook>
    It's good to see you again, {{playerName}}. You look good.
  </rook>
  <rook>
    There's something I need your help with.
    This is a job where I can only ask someone who I have complete trust in.
  </rook>
  <rook>
    The target of this operation is a 42-year-old white male named Stephen Tidus.
    Marital status: Single - never married.
    Sexual orientation: {$ playerGender == "man" ? "gay" : "straight" $}.
    Occupation: computerized robotics systems analyst at Funtronics, the toy company.
  </rook>
  <rook>
    We've only had two days to surveil him, but the picture we get is a man dedicated to his work.
    He lives in a studio apartment. He orders delivery 6 nights a week.
    And he seems to enjoy the company of toy prototypes more than people.
  </rook>
  <rook>
    Although he doesn't socialize, we did find something interesting in his garbage.
    It was a $49.99 receipt for registration in a service called LoveCassette.
    LoveCassette is a video matchmaking service. That's where you come in.
  </rook>
  <rook>
    As we speak, LoveCassette's scheduling system is being updated to show that Mr. Tidus has a date with a {{playerGender}} named {{playerName}}, tonight at 7pm.
  </rook>
  <rook>
    Your job will be simple. First, we're going to fit you with a wire. Then, on your date, you're to get Tidus talking.
    The wire will be connected to a radio uplink at a nearby control van.
    I'll be on-site, and we'll be recording the whole conversation.
  </rook>
  <rook>
    What we need is a recording of Tidus saying each of nine different designated words.
    How you get him to say each word will be up to your talent and discretion. But you must get him him to clearly say all nine words.
  </rook>
  <rook>
    I'm here to give you as much information as I can so this job will succeed.
    What questions do you have so far?
  </rook>

  <while cond="true" />
    <input />

    <var name="time" value="{$ timestamp(year, 6, 20) $}" />

    <llm:tag
      key="tags"
      no_more_questions="user says they have no further questions"
      real_name_is_martin_wayman="user seems to know that the person's name is Martin Wayman"
    >{{input}}</llm:tag>

    <if cond='includes(tags, "real_name_is_martin_wayman")'>
      <var name="knows_martin_wayman" value="true" type="boolean" />
    </if>

    <llm:dialog from="Rook" key="output_from_rook">
      You are a 48-year-old security consultant using the alias Rook.
      A week ago, a man named John Byne contacted you to do a job.
      There is a toy company called Playtronics that makes robotic toys. They are designing a new computer chip, and Byne wants you to exfiltrate its schematics.
      To get through Playtronics' security, one step is a voice checkpoint.

      You are talking to {{playerName}}, a {{playerGender}}.
      Answer in character as Rook. Keep responses grounded, calm, based on the information here.
      Use realistic, understated dialogue â€” no over-explaining.

      <when cond='knows_martin_wayman'>
        Your real name is Martin Wayman.
        You are a former hacker with a criminal record - you got busted during your college days.
        John Byne knows your history and real name, and is blackmailing you to do the Playtronics job.
        Once an idealistic hacker in the 1960s, you went underground after a run-in with the law. You reinvented yourself as Bishop, leading a team that tests corporate security systems.
      </when>

      It's {{formatDate(time, "YYYY/MM/DD HH:mm:ss")}} in {{location}}.
    </llm:dialog>

    <rook>
      {{output_from_rook}}
    </rook>

    <if cond='includes(tags, "no_more_questions")'>
      <break />
    </if>
  </while>
</sec>
